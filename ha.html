<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üì∏ PhotoBooth 6 Khung Live</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      background-color: #365876;
      color: white;
      padding: 20px;
    }

    h1 { margin-bottom: 15px; }

    /* --- v√πng ch·ª©a video --- */
    .booth-container {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
      background: white;
      padding: 10px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.4);
    }

    video {
      width: 240px;
      height: 180px;
      border-radius: 10px;
      border: 4px solid #333;
      background: #fff;
      object-fit: cover;
      filter: brightness(1.1) contrast(1.05) saturate(1.1);
    }

    /* --- n√∫t --- */
    button {
      margin: 10px;
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      color: white;
      background-color: #28a745;
      transition: background-color 0.3s;
    }
    button:hover { background-color: #218838; }

    /* --- gallery ·∫£nh --- */
    .gallery {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 10px;
      margin-top: 20px;
      width: 100%;
      max-width: 800px;
    }

    .photo-item {
      background: #fff;
      border-radius: 10px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      align-items: center;
      box-shadow: 0 2px 5px rgba(0,0,0,0.3);
    }

    .photo-item img {
      width: 100%;
      height: auto;
      display: block;
    }

    .photo-actions {
      display: flex;
      gap: 8px;
      padding: 5px;
      justify-content: center;
    }

    .photo-actions button {
      background: #dc3545;
    }
    .photo-actions button:hover {
      background: #c82333;
    }

    .counter {
      margin: 10px;
      font-size: 16px;
    }

    /* icon trang tr√≠ */
    .icon {
      position: absolute;
      width: 40px;
    }
    .icon1 { top: 10px; left: 10px; }
    .icon2 { top: 10px; right: 10px; }
    .icon3 { bottom: 10px; left: 10px; }
    .icon4 { bottom: 10px; right: 10px; }

    .cat-ears {
      position: absolute;
      top: 70px;
      left: 50%;
      transform: translateX(-50%);
      width: 120px;
      pointer-events: none;
      opacity: 0.9;
    }
  </style>
</head>
<body>
  <h1>üì∏ PhotoBooth 6 Khung Live</h1>

  <div class="booth-container" id="boothContainer">
    <video autoplay muted></video>
    <video autoplay muted></video>
    <video autoplay muted></video>
    <video autoplay muted></video>
    <video autoplay muted></video>
    <video autoplay muted></video>
  </div>

  <div>
    <button onclick="takePhoto()">üì∑ Ch·ª•p ·∫¢nh</button>
    <button onclick="downloadSelected()">‚¨áÔ∏è T·∫£i ·∫¢nh</button>
  </div>

  <div class="counter">·∫¢nh ƒë√£ ch·ªçn: <span id="count">0</span></div>

  <div class="gallery" id="gallery"></div>

  <!-- icon -->
  <img src="https://cdn-icons-png.flaticon.com/512/3159/3159066.png" class="icon icon1">
  <img src="https://cdn-icons-png.flaticon.com/512/616/616408.png" class="icon icon2">
  <img src="https://cdn-icons-png.flaticon.com/512/151/151773.png" class="icon icon3">
  <img src="https://cdn-icons-png.flaticon.com/512/727/727803.png" class="icon icon4">
  <img src="https://cdn-icons-png.flaticon.com/512/616/616408.png" class="cat-ears">

  <script>
    const videos = document.querySelectorAll("video");
    const gallery = document.getElementById("gallery");
    const countSpan = document.getElementById("count");

    navigator.mediaDevices.getUserMedia({ video: true })
      .then(stream => {
        videos.forEach(v => v.srcObject = stream);
      })
      .catch(err => alert("Kh√¥ng th·ªÉ truy c·∫≠p camera: " + err.message));

    function sleep(ms) {
      return new Promise(r => setTimeout(r, ms));
    }

    // üì∑ Ch·ª•p t·∫•t c·∫£ 6 khung (c√≥ delay mili-gi√¢y)
    async function takePhoto() {
      const width = videos[0].videoWidth;
      const height = videos[0].videoHeight;
      const canvas = document.createElement("canvas");
      const ctx = canvas.getContext("2d");
      canvas.width = width * 2;
      canvas.height = height * 3;

      let idx = 0;
      for (let row = 0; row < 3; row++) {
        for (let col = 0; col < 2; col++) {
          ctx.drawImage(videos[idx], col * width, row * height, width, height);
          idx++;
          await sleep(120); // delay nh·∫π gi·ªØa t·ª´ng khung ƒë·ªÉ kh√°c bi·ªÉu c·∫£m
        }
      }

      const data = canvas.toDataURL("image/png");
      addPhoto(data);
    }

    function addPhoto(data) {
      const item = document.createElement("div");
      item.className = "photo-item";
      const img = document.createElement("img");
      img.src = data;

      const actions = document.createElement("div");
      actions.className = "photo-actions";

      const checkbox = document.createElement("input");
      checkbox.type = "checkbox";
      checkbox.onchange = updateCount;

      const del = document.createElement("button");
      del.textContent = "X";
      del.onclick = () => { item.remove(); updateCount(); };

      actions.appendChild(checkbox);
      actions.appendChild(del);

      item.appendChild(img);
      item.appendChild(actions);
      gallery.appendChild(item);
    }

    function updateCount() {
      const cbs = document.querySelectorAll(".photo-item input[type='checkbox']");
      let c = 0;
      cbs.forEach(cb => { if (cb.checked) c++; });
      countSpan.textContent = c;
    }

    function downloadSelected() {
      const cbs = document.querySelectorAll(".photo-item input[type='checkbox']");
      cbs.forEach((cb, i) => {
        if (cb.checked) {
          const img = cb.closest(".photo-item").querySelector("img");
          const a = document.createElement("a");
          a.href = img.src;
          a.download = `photo_${i + 1}.png`;
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
         

        }
      });
    }
  

  </script>
</body>
</html>
